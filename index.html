<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spark Journal - ä¸ªäººåª’ä½“è®°å½•</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script>
    <style>
        :root {
            --primary-color: #6c5ce7;
            --primary-light: #a29bfe;
            --secondary-color: #fd79a8;
            --background: #f5f6fa;
            --surface: #ffffff;
            --text-primary: #2d3436;
            --text-secondary: #636e72;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #e17055;
            --border-radius: 12px;
            --shadow: 0 2px 10px rgba(0,0,0,0.08);
            --transition: all 0.3s ease;
            
            /* ç¨€æœ‰åº¦é¢œè‰² */
            --common-color: #b0b0b0;
            --rare-color: #4d7fff;
            --epic-color: #8a2be2;
            --legendary-color: #ff9900;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.5;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 100%;
            min-height: 100vh;
            padding: 0;
            margin: 0 auto;
            background-color: var(--background);
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: var(--surface);
            padding: 15px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .app-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .spark-display {
            display: flex;
            align-items: center;
            background-color: var(--primary-light);
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
        }

        .spark-icon {
            margin-right: 5px;
        }

        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--surface);
            display: flex;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 5px 0;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 12px;
            transition: var(--transition);
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 3px;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            padding: 15px;
            padding-bottom: 70px; /* ä¸ºåº•éƒ¨å¯¼èˆªç•™å‡ºç©ºé—´ */
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .section {
            background-color: var(--surface);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 8px;
            color: var(--primary-color);
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:active {
            background-color: var(--primary-light);
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-warning {
            background-color: var(--warning);
            color: white;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        /* ä½œå“å¡ç‰‡ */
        .item-card {
            background-color: var(--surface);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .item-card:active {
            transform: scale(0.98);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .item-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .item-meta {
            display: flex;
            gap: 8px;
            font-size: 12px;
        }

        .item-tag {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        .tag-status {
            background-color: var(--warning);
            color: white;
        }

        .tag-type {
            background-color: var(--primary-light);
            color: white;
        }

        .tag-done {
            background-color: var(--success);
            color: white;
        }

        .tag-dropped {
            background-color: var(--danger);
            color: white;
        }

        .item-rating {
            margin-top: 8px;
            color: var(--warning);
        }

        .item-comment {
            margin-top: 8px;
            font-style: italic;
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* è®¡æ—¶å™¨ */
        .timer-display {
            font-size: 48px;
            font-weight: 700;
            text-align: center;
            margin: 20px 0;
            color: var(--primary-color);
            font-variant-numeric: tabular-nums;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
        }

        .timer-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }

        /* AIæ¿€åŠ±å¡ç‰‡ */
        .ai-motivation {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .ai-motivation::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            z-index: 0;
        }

        .ai-content {
            position: relative;
            z-index: 1;
        }

        .ai-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .ai-icon {
            font-size: 24px;
            margin-right: 10px;
        }

        .ai-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 2px solid white;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #666;
        }

        .ai-avatar-card {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .ai-text {
            font-size: 16px;
            line-height: 1.4;
        }

        .ai-hint {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 10px;
            text-align: center;
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-card {
            background-color: var(--primary-light);
            border-radius: var(--border-radius);
            padding: 15px;
            text-align: center;
            color: white;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        /* å¥–åŠ±é¡¹ */
        .reward-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .reward-item:last-child {
            border-bottom: none;
        }

        .reward-info h4 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .reward-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .reward-cost {
            background-color: var(--secondary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 50px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background-color: var(--surface);
            width: 100%;
            max-width: 500px;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background-color: var(--surface);
        }

        .form-textarea {
            height: 100px;
            resize: vertical;
        }

        /* é€šçŸ¥ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1001;
            display: flex;
            align-items: center;
            animation: slideInRight 0.5s, fadeOut 0.5s 2.5s forwards;
        }

        .notification i {
            margin-right: 8px;
        }

        /* åŠ¨ç”» */
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .timer-controls {
                flex-direction: column;
            }
        }

        /* æŠ½å¡ç›¸å…³æ–°æ ·å¼ */
        .gacha-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .gacha-cost {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 10px 0;
            font-size: 18px;
        }

        .gacha-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        .gacha-btn:active {
            transform: scale(0.95);
        }

        .gacha-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
        }

        .card-display {
            width: 120px;
            height: 160px;
            margin: 15px auto;
            border-radius: 12px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            overflow: hidden;
            position: relative;
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .card-placeholder {
            color: #666;
            font-size: 14px;
            text-align: center;
            padding: 20px;
        }

        /* æ”¶é›†å†Œæ ·å¼ */
        .collection-series {
            margin-bottom: 25px;
        }

        .series-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-light);
        }

        .series-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .series-progress {
            font-size: 14px;
            color: var(--text-secondary);
            background: var(--primary-light);
            padding: 4px 12px;
            border-radius: 15px;
            color: white;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .collection-card {
            aspect-ratio: 3/4;
            border-radius: 8px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent; /* é»˜è®¤é€æ˜è¾¹æ¡† */
        }

        .collection-card.obtained .card-image {
            opacity: 1;
        }

        .collection-card .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.3;
            transition: opacity 0.3s ease;
        }

        .card-locked {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #999;
            font-size: 24px;
        }

        /* ç¨€æœ‰åº¦è¾¹æ¡†æ ·å¼ - åªåœ¨è·å¾—å¡ç‰Œåæ˜¾ç¤º */
        .collection-card.obtained.rarity-common {
            border: 2px solid var(--common-color);
        }

        .collection-card.obtained.rarity-rare {
            border: 2px solid var(--rare-color);
            box-shadow: 0 0 8px var(--rare-color);
        }

        .collection-card.obtained.rarity-epic {
            border: 2px solid transparent;
            background: linear-gradient(45deg, var(--epic-color), #ff69b4) border-box;
            box-shadow: 0 0 12px rgba(138, 43, 226, 0.5);
        }

        .collection-card.obtained.rarity-legendary {
            border: 2px solid var(--legendary-color);
            animation: glow 2s infinite alternate;
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.7);
        }

        /* æŠ½å¡æ˜¾ç¤ºåŒºåŸŸçš„ç¨€æœ‰åº¦è¾¹æ¡† */
        .card-display.rarity-common {
            border: 2px solid var(--common-color);
        }

        .card-display.rarity-rare {
            border: 2px solid var(--rare-color);
            box-shadow: 0 0 8px var(--rare-color);
        }

        .card-display.rarity-epic {
            border: 2px solid transparent;
            background: linear-gradient(45deg, var(--epic-color), #ff69b4) border-box;
            box-shadow: 0 0 12px rgba(138, 43, 226, 0.5);
        }

        .card-display.rarity-legendary {
            border: 2px solid var(--legendary-color);
            animation: glow 2s infinite alternate;
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.7);
        }

        @keyframes glow {
            from {
                box-shadow: 0 0 5px var(--legendary-color);
            }
            to {
                box-shadow: 0 0 20px var(--legendary-color);
            }
        }

        .rarity-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        /* æŠ½å¡åŠ¨ç”» */
        @keyframes drawCard {
            0% { transform: scale(0.8) rotateY(0deg); opacity: 0; }
            50% { transform: scale(1.1) rotateY(180deg); opacity: 1; }
            100% { transform: scale(1) rotateY(360deg); opacity: 1; }
        }

        .card-animation {
            animation: drawCard 0.8s ease-out;
        }

        /* æ–°å¡ç‰‡æç¤º */
        .new-card-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--secondary-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* å­˜å‚¨çŠ¶æ€æç¤º */
        .storage-status {
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            background: var(--warning);
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            z-index: 99;
            display: none;
        }

        /* å¡ç‰Œæ–‡æœ¬å†…å®¹æ ·å¼ */
        .card-text-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            text-align: center;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
        }

        /* AIå¤´åƒè¿·ä½ å¡ç‰Œæ ·å¼ */
        .ai-avatar-mini-card {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #666;
            overflow: hidden;
        }

        .ai-avatar-mini-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- å­˜å‚¨çŠ¶æ€æç¤º -->
        <div class="storage-status" id="storage-status"></div>
        
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <header class="app-header">
            <div class="app-title">Spark Journal</div>
            <div class="spark-display">
                <span class="spark-icon">ğŸ”¥</span>
                <span id="spark-count">0.0</span>
            </div>
        </header>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <!-- AIæ¿€åŠ±å¡ç‰‡ -->
            <div class="ai-motivation" id="ai-motivation">
                <div class="ai-content">
                    <div class="ai-header">
                        <div class="ai-avatar-mini-card" id="ai-avatar">
                            <span>ğŸ¹</span>
                        </div>
                        <h3>å¥¶èŒ¶é¼ åŠ©æ‰‹</h3>
                    </div>
                    <div class="ai-text" id="ai-text">
                        æ¬¢è¿ä½¿ç”¨Spark Journalï¼å¼€å§‹è®°å½•ä½ çš„ç¬¬ä¸€ä¸ªä½œå“å§ï¼
                    </div>
                    <div class="ai-hint">
                        <i class="fas fa-sync-alt"></i> ç‚¹å‡»åˆ·æ–°æ¿€åŠ±è¯­
                    </div>
                </div>
            </div>

            <!-- ä½œå“åº“é¡µé¢ -->
            <div class="page active" id="library-page">
                <div class="section">
                    <button class="btn btn-primary" id="add-item-btn">
                        <i class="fas fa-plus"></i> æ·»åŠ æ–°ä½œå“
                    </button>
                </div>
                
                <div id="items-container">
                    <!-- ä½œå“å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                </div>
                
                <div class="empty-state" id="empty-library">
                    <i class="fas fa-book-open"></i>
                    <h3>è¿˜æ²¡æœ‰ä½œå“è®°å½•</h3>
                    <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä½œå“</p>
                </div>
            </div>

            <!-- ä¸“æ³¨é¡µé¢ -->
            <div class="page" id="focus-page">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-clock"></i> ä¸“æ³¨è®¡æ—¶å™¨
                    </h2>
                    <p style="text-align: center; margin-bottom: 15px; color: var(--text-secondary);">
                        ä¸“æ³¨æŠ•å…¥ä½œå“ï¼Œæ¯25åˆ†é’Ÿå¯è·å¾—0.1ç«èŠ±
                    </p>
                    <div class="timer-display" id="timer-display">25:00</div>
                    <div class="timer-controls">
                        <button class="timer-btn btn-success" id="start-timer">å¼€å§‹</button>
                        <button class="timer-btn btn-warning" id="pause-timer" disabled>æš‚åœ</button>
                        <button class="timer-btn btn-danger" id="reset-timer">é‡ç½®</button>
                    </div>
                    <button class="btn btn-primary" id="claim-sparks" disabled style="margin-top: 15px;">
                        é¢†å–ç«èŠ± (+0.1)
                    </button>
                </div>
                
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-play-circle"></i> æ­£åœ¨è¿›è¡Œçš„ä½œå“
                    </h2>
                    <div id="doing-items-container">
                        <!-- æ­£åœ¨è¿›è¡Œçš„ä½œå“å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                    
                    <div class="empty-state" id="empty-doing">
                        <i class="fas fa-hourglass-half"></i>
                        <h3>æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„ä½œå“</h3>
                        <p>åœ¨ä½œå“åº“ä¸­å°†ä½œå“çŠ¶æ€è®¾ä¸º"åœ¨æ"åï¼Œå¯ä»¥åœ¨è¿™é‡Œå¼€å§‹ä¸“æ³¨</p>
                    </div>
                </div>
            </div>

            <!-- ç»Ÿè®¡é¡µé¢ -->
            <div class="page" id="stats-page">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar"></i> æ•°æ®æ¦‚è§ˆ
                    </h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="total-items">0</div>
                            <div class="stat-label">æ€»ä½œå“æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="completed-items">0</div>
                            <div class="stat-label">å·²å®Œæˆ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avg-rating">0.0</div>
                            <div class="stat-label">å¹³å‡è¯„åˆ†</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="total-sparks">0.0</div>
                            <div class="stat-label">æ€»ç«èŠ±æ•°</div>
                        </div>
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-chart-pie"></i> ä½œå“ç±»å‹åˆ†å¸ƒ
                    </h2>
                    <div id="type-chart">
                        <!-- ç±»å‹åˆ†å¸ƒå›¾è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-tasks"></i> ä½œå“çŠ¶æ€åˆ†å¸ƒ
                    </h2>
                    <div id="status-chart">
                        <!-- çŠ¶æ€åˆ†å¸ƒå›¾è¡¨å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- å¥–åŠ±é¡µé¢ -->
            <div class="page" id="rewards-page">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-gift"></i> å¥–åŠ±å…‘æ¢
                    </h2>
                    
                    <div class="gacha-section">
                        <h3 style="margin-bottom: 10px;">å¡ç‰ŒæŠ½å¥–</h3>
                        <p style="margin-bottom: 15px; opacity: 0.9;">èŠ±è´¹ç«èŠ±æŠ½å–éšæœºå¡ç‰Œï¼Œæ”¶é›†å®Œæ•´ç³»åˆ—ï¼</p>
                        
                        <div class="card-display" id="card-display">
                            <div class="card-placeholder">ç‚¹å‡»æŠ½å¡è·å¾—ç¬¬ä¸€å¼ å¡ç‰Œï¼</div>
                        </div>
                        
                        <div class="gacha-cost">
                            <span class="spark-icon">ğŸ”¥</span>
                            <span>1.0 ç«èŠ±</span>
                        </div>
                        
                        <button class="gacha-btn" id="gacha-btn">
                            <i class="fas fa-dice"></i> æŠ½ä¸€æ¬¡
                        </button>
                        
                        <p style="font-size: 12px; margin-top: 10px; opacity: 0.7;">
                            å·²æ”¶é›†: <span id="collected-count">0</span> / <span id="total-cards">0</span> å¼ 
                        </p>
                    </div>
                    
                    <div class="rewards-list">
                        <div class="reward-item">
                            <div class="reward-info">
                                <h4>ä¸€æ¯å¥¶èŒ¶</h4>
                                <p>å¥–åŠ±è‡ªå·±ä¸€æ¯å–œæ¬¢çš„é¥®æ–™</p>
                            </div>
                            <div>
                                <span class="reward-cost">-5.0 ç«èŠ±</span>
                                <button class="btn btn-primary" data-cost="5.0" style="padding: 8px 15px; margin-left: 10px;">å…‘æ¢</button>
                            </div>
                        </div>
                        
                        <div class="reward-item">
                            <div class="reward-info">
                                <h4>ä¹°ä¸€æ¬¾æ¸¸æˆ</h4>
                                <p>è´­ä¹°ä¸€æ¬¾æƒ³ç©çš„æ¸¸æˆ</p>
                            </div>
                            <div>
                                <span class="reward-cost">-2.0 ç«èŠ±</span>
                                <button class="btn btn-primary" data-cost="2.0" style="padding: 8px 15px; margin-left: 10px;">å…‘æ¢</button>
                            </div>
                        </div>
                        
                        <div class="reward-item">
                            <div class="reward-info">
                                <h4>åˆ·çŸ­è§†é¢‘/æ— æ„ä¹‰å†…å®¹30åˆ†é’Ÿ</h4>
                                <p>å…è®¸è‡ªå·±åˆ·30åˆ†é’Ÿæ— æ„ä¹‰å†…å®¹</p>
                            </div>
                            <div>
                                <span class="reward-cost">-0.5 ç«èŠ±</span>
                                <button class="btn btn-primary" data-cost="0.5" style="padding: 8px 15px; margin-left: 10px;">å…‘æ¢</button>
                            </div>
                        </div>
                        
                        <div class="reward-item">
                            <div class="reward-info">
                                <h4>è‡ªå®šä¹‰å¥–åŠ±</h4>
                                <input type="text" id="custom-reward" placeholder="è¾“å…¥ä½ çš„å¥–åŠ±" class="form-input" style="margin-top: 5px;">
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                                <input type="number" id="custom-cost" min="0.1" step="0.1" value="1.0" class="form-input" style="width: 80px;">
                                <span>ç«èŠ±</span>
                                <button class="btn btn-primary" id="add-custom-reward" style="padding: 8px 15px;">æ·»åŠ </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ”¶é›†å†Œé¡µé¢ -->
            <div class="page" id="collection-page">
                <div class="section">
                    <h2 class="section-title">
                        <i class="fas fa-bookmark"></i> æˆ‘çš„æ”¶é›†å†Œ
                    </h2>
                    
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="background: var(--primary-light); color: white; padding: 10px 20px; border-radius: 20px; display: inline-block;">
                            æ€»æ”¶é›†è¿›åº¦: <span id="total-progress">0%</span>
                        </div>
                    </div>
                    
                    <div id="collection-container">
                        <!-- ç³»åˆ—å’Œå¡ç‰Œå°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </main>

        <!-- åº•éƒ¨å¯¼èˆª -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" data-page="library-page">
                <i class="fas fa-book nav-icon"></i>
                <span>ä½œå“åº“</span>
            </a>
            <a href="#" class="nav-item" data-page="focus-page">
                <i class="fas fa-clock nav-icon"></i>
                <span>ä¸“æ³¨</span>
            </a>
            <a href="#" class="nav-item" data-page="stats-page">
                <i class="fas fa-chart-bar nav-icon"></i>
                <span>ç»Ÿè®¡</span>
            </a>
            <a href="#" class="nav-item" data-page="rewards-page">
                <i class="fas fa-gift nav-icon"></i>
                <span>å¥–åŠ±</span>
            </a>
            <a href="#" class="nav-item" data-page="collection-page">
                <i class="fas fa-bookmark nav-icon"></i>
                <span>æ”¶é›†å†Œ</span>
            </a>
        </nav>
    </div>

    <!-- æ·»åŠ ä½œå“æ¨¡æ€æ¡† -->
    <div class="modal" id="add-item-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">æ·»åŠ æ–°ä½œå“</h2>
                <button class="close-btn" id="close-modal">&times;</button>
            </div>
            <form id="item-form">
                <div class="form-group">
                    <label class="form-label" for="item-title">ä½œå“åç§°</label>
                    <input type="text" class="form-input" id="item-title" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="item-type">ä½œå“ç±»å‹</label>
                    <select class="form-select" id="item-type" required>
                        <option value="">è¯·é€‰æ‹©ç±»å‹</option>
                        <option value="æ¸¸æˆ">æ¸¸æˆ</option>
                        <option value="ä¹¦ç±">ä¹¦ç±</option>
                        <option value="è§†é¢‘">è§†é¢‘</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="item-status">å½“å‰çŠ¶æ€</label>
                    <select class="form-select" id="item-status" required>
                        <option value="">è¯·é€‰æ‹©çŠ¶æ€</option>
                        <option value="æƒ³è¯•">æƒ³è¯•</option>
                        <option value="åœ¨æ">åœ¨æ</option>
                        <option value="å·²å®Œæˆï¼">å·²å®Œæˆï¼</option>
                        <option value="å·²å¼ƒå‘">å·²å¼ƒå‘</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="item-rating">è¯„åˆ† (1-10)</label>
                    <input type="number" class="form-input" id="item-rating" min="1" max="10" step="0.1">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="item-comment">çŸ­è¯„</label>
                    <textarea class="form-textarea" id="item-comment"></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary">ä¿å­˜ä½œå“</button>
            </form>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–localForage
        const storage = localforage.createInstance({
            name: 'SparkJournal',
            driver: [localforage.INDEXEDDB, localforage.WEBSQL, localforage.LOCALSTORAGE]
        });

        // å¥¶èŒ¶é¼ é£æ ¼AIæ¿€åŠ±è¯­åº“
        const milkTeaMotivations = {
            welcome: [
                "æ¬¢è¿æ¥åˆ°Spark Journalå•¦~ æˆ‘æ˜¯å¥¶èŒ¶é¼ niaï¼ğŸ¥¤",
                "å‡†å¤‡å¥½å’Œå¥¶èŒ¶é¼ ä¸€èµ·è®°å½•ç²¾å½©ä½œå“äº†å—ï¼Ÿnia",
                "æ¥å•¦æ¥å•¦~ å¥¶èŒ¶é¼ å¸¦ç€ç«èŠ±å’Œé¼“åŠ±å‡ºç°å•¦niaï¼",
                "å—¨~ æˆ‘æ˜¯å¥¶èŒ¶é¼ niaï¼Œæˆ‘ä»¬ä¸€èµ·è®©è‡ªå¾‹å˜å¾—æœ‰è¶£å§ï¼ğŸ¥¤âœ¨"
            ],
            empty: [
                "ä½ çš„ä½œå“åº“ç©ºç©ºå¦‚ä¹Ÿï¼Œå¿«åŠ ç‚¹ä¸œè¥¿è¿›å»å§ï¼Œnia",
                "æ²¡æœ‰è®°å½•çš„ä½œå“å°±åƒæ²¡æœ‰çç çš„å¥¶èŒ¶ï¼ŒåŠ ç‚¹æ–™å§ï¼ğŸ¥¤",
                "nia ä½œå“åº“ç©ºç©ºçš„ï¼Œå¥¶èŒ¶é¼ æœ‰ç‚¹å¯‚å¯å‘¢...",
                "å¿«æ·»åŠ ç¬¬ä¸€ä¸ªä½œå“å§ï¼Œå¥¶èŒ¶é¼ å·²ç»ç­‰ä¸åŠè¦çœ‹å•¦ï¼"
            ],
            progress: [
                "å“‡~ ä½ å·²ç»å®Œæˆäº†{completed}éƒ¨ä½œå“ï¼ç»§ç»­ä¿æŒè¿™ä¸ªåŠ¿å¤´ï¼Œniaï¼",
                "ä¸“æ³¨{totalHours}å°æ—¶ï¼Œè·å¾—äº†{sparks}ç«èŠ±ï¼Œå¤ªå‰å®³å•¦ï¼ğŸ¥¤",
                "ä½ çš„{completed}éƒ¨å·²å®Œæˆä½œå“è¯æ˜äº†ä½ çš„åšæŒï¼Œå¥¶èŒ¶é¼ ä¸ºä½ éª„å‚²ï¼",
                "å±å±~ {completed}éƒ¨ä½œå“å®Œæˆå•¦ï¼åƒå¥¶èŒ¶é‡Œçš„çç ä¸€æ ·å¤šå‘¢ï¼"
            ],
            encouragement: [
                "ä¸“æ³¨25åˆ†é’Ÿå°±èƒ½è·å¾—0.1ç«èŠ±ï¼Œæ¯ä¸€åˆ†é’Ÿéƒ½åƒå¥¶èŒ¶ä¸€æ ·é¦™ç”œï¼",
                "å®Œæˆä¸€éƒ¨ä½œå“å¯ä»¥è·å¾—1ç«èŠ±ï¼Œæ¯”ä¸“æ³¨æ›´æœ‰æ•ˆç‡å–”~ niaï¼",
                "ä½ çš„{doingCount}éƒ¨è¿›è¡Œä¸­ä½œå“æ­£åœ¨ç­‰å¾…å®Œæˆï¼ŒåŠ æ²¹å•¦ï¼",
                "å¹³å‡è¯„åˆ†{avgRating}ï¼Œè¯´æ˜ä½ å¾ˆæœ‰å“å‘³å‘¢ï¼Œåƒé€‰å¥¶èŒ¶ä¸€æ ·å‡†ï¼",
                "ç«èŠ±å·²ç»ç§¯ç´¯åˆ°{sparks}äº†ï¼Œç¦»å¥–åŠ±è¶Šæ¥è¶Šè¿‘äº†ï¼Œnia~"
            ],
            humorous: [
                "åˆ«è®©æƒ³è¯•åˆ—è¡¨è¶Šæ¥è¶Šé•¿ï¼Œå®Œæˆåˆ—è¡¨å´ä¸€åŠ¨ä¸åŠ¨ï¼æŠ—è®®niaï¼",
                "ä½ çš„ä¸“æ³¨æ—¶é—´æ¯”åˆ·çŸ­è§†é¢‘çš„æ—¶é—´è¿˜å°‘ï¼Ÿå¥¶èŒ¶é¼ ä¸ä¿¡ï¼ğŸ¥¤",
                "å®Œæˆä¸€éƒ¨ä½œå“è·å¾—çš„ç«èŠ±ï¼Œå¤Ÿä½ åˆ·1å°æ—¶çŸ­è§†é¢‘å‘¢ï¼Œåˆ’ç®—å§ï¼",
                "ä½ çš„{doingCount}éƒ¨è¿›è¡Œä¸­ä½œå“è¯´ï¼š'é€‰æˆ‘ï¼é€‰æˆ‘ï¼' nia",
                "ç«èŠ±ä¸ä¼šè‡ªå·±å¢åŠ ï¼Œä½†æ‹–å»¶ç—‡ä¼šè‡ªå·±å‘ä½œï¼å¥¶èŒ¶é¼ æé†’ä½ ~"
            ],
            milkTeaThemed: [
                "ä½ çš„ç«èŠ±åƒçç å¥¶èŒ¶é‡Œçš„çç ä¸€æ ·å¤šå•¦~ å¼€å¿ƒniaï¼",
                "æ¯ä¸€ç‚¹ä¸“æ³¨éƒ½åƒå¥¶èŒ¶é‡Œçš„ç³–åˆ†ï¼Œè®©ç”Ÿæ´»æ›´ç”œç¾ï¼ğŸ¥¤",
                "å®Œæˆä½œå“å°±åƒå–å®Œä¸€æ¯å¥¶èŒ¶ï¼Œæ»¡è¶³æ„Ÿçˆ†æ£šï¼",
                "nia ä½ çš„è¿›åº¦è®©å¥¶èŒ¶é¼ æƒ³å–æ¯å¥¶èŒ¶åº†ç¥ä¸€ä¸‹ï¼",
                "ä¸“æ³¨æ—¶é—´åˆ°ï¼å¥¶èŒ¶é¼ ç»™ä½ åŠ æ²¹ï¼ŒåƒåŠ çç ä¸€æ ·åŠ æŠŠåŠ²ï¼"
            ]
        };
        
        // å¡ç‰Œæ•°æ® - ä¿ç•™å›¾ç‰‡è·¯å¾„
        const cardData = {
            series1: {
                name: "å¥¶èŒ¶é¼ ç³»åˆ—",
                cards: [
                    { id: "series1_01", name: "æ³¡æ³¡", image: "images/cards/series1/card1.jpg", rarity: "æ™®é€š" },
                    { id: "series1_02", name: "å´©æºƒ", image: "images/cards/series1/card2.jpg", rarity: "æ™®é€š" },
                    { id: "series1_03", name: "æ¼ç«", image: "images/cards/series1/card3.jpg", rarity: "ç¨€æœ‰" },
                    { id: "series1_04", name: "å¼€é¥­", image: "images/cards/series1/card4.jpg", rarity: "ç¨€æœ‰" },
                    { id: "series1_05", name: "å»å­¦ä¹ ", image: "images/cards/series1/card5.jpg", rarity: "å²è¯—" },
                    { id: "series1_06", name: "æˆ‘æœ‰ä¸€ä¸ªé¦Šä¸»æ„", image: "images/cards/series1/card6.jpg", rarity: "ä¼ è¯´" },
                    { id: "series1_07", name: "å§”å±ˆ", image: "images/cards/series1/card7.jpg", rarity: "å²è¯—" },
                    { id: "series1_08", name: "å–œæ¬¢", image: "images/cards/series1/card8.jpg", rarity: "å²è¯—" },
                    { id: "series1_09", name: "å", image: "images/cards/series1/card9.jpg", rarity: "ç¨€æœ‰" },
                    { id: "series1_10", name: "å±", image: "images/cards/series1/card10.jpg", rarity: "ç¨€æœ‰" },
                    { id: "series1_11", name: "å¥½è€¶", image: "images/cards/series1/card11.jpg", rarity: "ç¨€æœ‰" },
                    { id: "series1_12", name: "æ¥å•¦", image: "images/cards/series1/card12.jpg", rarity: "æ™®é€š" },
                    { id: "series1_13", name: "éº»äº†", image: "images/cards/series1/card13.jpg", rarity: "æ™®é€š" },
                    { id: "series1_14", name: "æ’å¢™", image: "images/cards/series1/card14.jpg", rarity: "æ™®é€š" },
                    { id: "series1_15", name: "è¿·å¹»", image: "images/cards/series1/card15.jpg", rarity: "æ™®é€š" },
                    { id: "series1_16", name: "ä¹–", image: "images/cards/series1/card16.jpg", rarity: "æ™®é€š" },
                    { id: "series1_17", name: "è¿ç¯ç‚®", image: "images/cards/series1/card17.jpg", rarity: "æ™®é€š" }
                ]
            }
        };

        // åº”ç”¨çŠ¶æ€å’Œæ•°æ®
        const appState = {
            items: [],
            sparks: 0.0,
            timer: {
                isRunning: false,
                timeLeft: 25 * 60, // 25åˆ†é’Ÿï¼Œä»¥ç§’ä¸ºå•ä½
                interval: null
            },
            collectedCards: []
        };
        
        // DOMå…ƒç´ 
        const elements = {
            sparkCount: document.getElementById('spark-count'),
            itemsContainer: document.getElementById('items-container'),
            doingItemsContainer: document.getElementById('doing-items-container'),
            emptyLibrary: document.getElementById('empty-library'),
            emptyDoing: document.getElementById('empty-doing'),
            addItemBtn: document.getElementById('add-item-btn'),
            addItemModal: document.getElementById('add-item-modal'),
            closeModal: document.getElementById('close-modal'),
            itemForm: document.getElementById('item-form'),
            navItems: document.querySelectorAll('.nav-item'),
            pages: document.querySelectorAll('.page'),
            timerDisplay: document.getElementById('timer-display'),
            startTimer: document.getElementById('start-timer'),
            pauseTimer: document.getElementById('pause-timer'),
            resetTimer: document.getElementById('reset-timer'),
            claimSparks: document.getElementById('claim-sparks'),
            totalItems: document.getElementById('total-items'),
            completedItems: document.getElementById('completed-items'),
            avgRating: document.getElementById('avg-rating'),
            totalSparks: document.getElementById('total-sparks'),
            typeChart: document.getElementById('type-chart'),
            statusChart: document.getElementById('status-chart'),
            rewardButtons: document.querySelectorAll('[data-cost]'),
            addCustomReward: document.getElementById('add-custom-reward'),
            aiMotivation: document.getElementById('ai-motivation'),
            aiText: document.getElementById('ai-text'),
            aiAvatar: document.getElementById('ai-avatar'),
            gachaBtn: document.getElementById('gacha-btn'),
            cardDisplay: document.getElementById('card-display'),
            collectedCount: document.getElementById('collected-count'),
            totalCards: document.getElementById('total-cards'),
            collectionContainer: document.getElementById('collection-container'),
            totalProgress: document.getElementById('total-progress'),
            storageStatus: document.getElementById('storage-status')
        };
        
        // åˆå§‹åŒ–åº”ç”¨
        async function initApp() {
            // ä»å­˜å‚¨åŠ è½½æ•°æ®
            await loadData();
            
            updateSparkDisplay();
            renderItems();
            setupEventListeners();
            updateStats();
            updateAIMotivation();
            initCardSystem();
            
            // æ˜¾ç¤ºå­˜å‚¨çŠ¶æ€
            showStorageStatus("æ•°æ®åŠ è½½å®Œæˆï¼");
        }
        
        // ä»å­˜å‚¨åŠ è½½æ•°æ®
        async function loadData() {
            try {
                const items = await storage.getItem('items');
                const sparks = await storage.getItem('sparks');
                const collectedCards = await storage.getItem('collectedCards');
                
                if (items) appState.items = items;
                if (sparks) appState.sparks = parseFloat(sparks);
                if (collectedCards) appState.collectedCards = collectedCards;
                
                console.log("æ•°æ®åŠ è½½æˆåŠŸ");
            } catch (error) {
                console.error("åŠ è½½æ•°æ®å¤±è´¥:", error);
                showStorageStatus("åŠ è½½æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®");
            }
        }
        
        // ä¿å­˜æ•°æ®åˆ°å­˜å‚¨
        async function saveData() {
            try {
                await storage.setItem('items', appState.items);
                await storage.setItem('sparks', appState.sparks.toString());
                await storage.setItem('collectedCards', appState.collectedCards);
                console.log("æ•°æ®ä¿å­˜æˆåŠŸ");
                return true;
            } catch (error) {
                console.error("ä¿å­˜æ•°æ®å¤±è´¥:", error);
                showStorageStatus("ä¿å­˜æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥å­˜å‚¨ç©ºé—´");
                return false;
            }
        }
        
        // æ˜¾ç¤ºå­˜å‚¨çŠ¶æ€
        function showStorageStatus(message) {
            elements.storageStatus.textContent = message;
            elements.storageStatus.style.display = 'block';
            
            setTimeout(() => {
                elements.storageStatus.style.display = 'none';
            }, 3000);
        }
        
        // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
        function setupEventListeners() {
            // åº•éƒ¨å¯¼èˆªåˆ‡æ¢
            elements.navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = item.getAttribute('data-page');
                    switchPage(pageId);
                    
                    // æ›´æ–°å¯¼èˆªçŠ¶æ€
                    elements.navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                });
            });
            
            // AIæ¿€åŠ±å¡ç‰‡ç‚¹å‡»äº‹ä»¶
            elements.aiMotivation.addEventListener('click', updateAIMotivation);
            
            // æ¨¡æ€æ¡†
            elements.addItemBtn.addEventListener('click', () => {
                elements.addItemModal.style.display = 'flex';
            });
            
            elements.closeModal.addEventListener('click', () => {
                elements.addItemModal.style.display = 'none';
            });
            
            // è¡¨å•æäº¤
            elements.itemForm.addEventListener('submit', handleFormSubmit);
            
            // è®¡æ—¶å™¨æ§åˆ¶
            elements.startTimer.addEventListener('click', startTimer);
            elements.pauseTimer.addEventListener('click', pauseTimer);
            elements.resetTimer.addEventListener('click', resetTimer);
            elements.claimSparks.addEventListener('click', claimSparks);
            
            // å¥–åŠ±å…‘æ¢
            elements.rewardButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const cost = parseFloat(button.getAttribute('data-cost'));
                    let rewardName = '';
                    
                    if (button.id !== 'add-custom-reward') {
                        rewardName = button.parentElement.parentElement.querySelector('h4').textContent;
                    } else {
                        rewardName = document.getElementById('custom-reward').value;
                        if (!rewardName) {
                            alert('è¯·è¾“å…¥å¥–åŠ±åç§°');
                            return;
                        }
                    }
                    
                    redeemReward(cost, rewardName);
                });
            });
            
            elements.addCustomReward.addEventListener('click', () => {
                const cost = parseFloat(document.getElementById('custom-cost').value);
                const rewardName = document.getElementById('custom-reward').value;
                
                if (!rewardName) {
                    alert('è¯·è¾“å…¥å¥–åŠ±åç§°');
                    return;
                }
                
                if (isNaN(cost) || cost <= 0) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç«èŠ±æ•°é‡');
                    return;
                }
                
                redeemReward(cost, rewardName);
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('custom-reward').value = '';
                document.getElementById('custom-cost').value = '1.0';
            });
        }

        // åˆå§‹åŒ–å¡ç‰Œç³»ç»Ÿ
        function initCardSystem() {
            updateCardDisplay();
            updateCollectionStats();
            renderCollection();
            
            // æŠ½å¡æŒ‰é’®äº‹ä»¶
            elements.gachaBtn.addEventListener('click', drawCard);
        }
        
        // æ›´æ–°AIæ¿€åŠ±è¯­
        function updateAIMotivation() {
            const completedCount = appState.items.filter(item => item.status === 'å·²å®Œæˆï¼').length;
            const doingCount = appState.items.filter(item => item.status === 'åœ¨æ').length;
            const totalHours = (appState.sparks * 10).toFixed(1); // ä¼°ç®—ä¸“æ³¨å°æ—¶æ•°
            const ratedItems = appState.items.filter(item => item.rating);
            const avgRating = ratedItems.length > 0 ? 
                (ratedItems.reduce((sum, item) => sum + item.rating, 0) / ratedItems.length).toFixed(1) : 
                '0.0';
            
            let motivationPool = [];
            
            if (appState.items.length === 0) {
                motivationPool = milkTeaMotivations.empty;
            } else if (completedCount === 0) {
                motivationPool = [...milkTeaMotivations.encouragement, ...milkTeaMotivations.humorous];
            } else {
                motivationPool = [
                    ...milkTeaMotivations.progress,
                    ...milkTeaMotivations.encouragement, 
                    ...milkTeaMotivations.humorous,
                    ...milkTeaMotivations.milkTeaThemed
                ];
            }
            
            // éšæœºé€‰æ‹©ä¸€æ¡æ¿€åŠ±è¯­
            const randomMotivation = motivationPool[Math.floor(Math.random() * motivationPool.length)];
            
            // æ›¿æ¢æ¨¡æ¿å˜é‡
            let finalMotivation = randomMotivation
                .replace('{completed}', completedCount)
                .replace('{doingCount}', doingCount)
                .replace('{totalHours}', totalHours)
                .replace('{sparks}', appState.sparks.toFixed(1))
                .replace('{avgRating}', avgRating);
            
            elements.aiText.textContent = finalMotivation;
            
            // æ›´æ–°AIå¤´åƒï¼ˆä½¿ç”¨å·²æ”¶é›†çš„å¡ç‰Œï¼‰
            updateAIAvatar();
        }
        
        // æ›´æ–°AIå¤´åƒ
        function updateAIAvatar() {
            if (appState.collectedCards.length > 0) {
                // ä»å·²æ”¶é›†çš„å¡ç‰Œä¸­éšæœºé€‰æ‹©ä¸€ä¸ª
                const randomCardId = appState.collectedCards[Math.floor(Math.random() * appState.collectedCards.length)];
                const card = findCardById(randomCardId);
                
                if (card) {
                    // æ¸…ç©ºå½“å‰å¤´åƒå†…å®¹
                    elements.aiAvatar.innerHTML = '';
                    
                    // å°è¯•åŠ è½½å›¾ç‰‡
                    const avatarImg = document.createElement('img');
                    avatarImg.src = card.image;
                    avatarImg.alt = card.name;
                    avatarImg.onerror = function() {
                        // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºæ–‡æœ¬å†…å®¹
                        this.style.display = 'none';
                        const textContent = document.createElement('span');
                        textContent.textContent = 'ğŸ¹';
                        textContent.style.fontSize = '18px';
                        elements.aiAvatar.appendChild(textContent);
                    };
                    
                    avatarImg.onload = function() {
                        // å›¾ç‰‡åŠ è½½æˆåŠŸï¼Œç§»é™¤ä»»ä½•å¯èƒ½å­˜åœ¨çš„æ–‡æœ¬å†…å®¹
                        const existingText = elements.aiAvatar.querySelector('span');
                        if (existingText) {
                            existingText.remove();
                        }
                    };
                    
                    elements.aiAvatar.appendChild(avatarImg);
                }
            } else {
                // å¦‚æœæ²¡æœ‰æ”¶é›†åˆ°å¡ç‰Œï¼Œæ˜¾ç¤ºé»˜è®¤å¤´åƒ
                elements.aiAvatar.innerHTML = '<span>ğŸ¹</span>';
            }
        }
        
        // åˆ‡æ¢é¡µé¢
        function switchPage(pageId) {
            // æ›´æ–°é¡µé¢æ˜¾ç¤º
            elements.pages.forEach(page => {
                if (page.id === pageId) {
                    page.classList.add('active');
                } else {
                    page.classList.remove('active');
                }
            });
            
            // å¦‚æœæ˜¯ä¸“æ³¨é¡µé¢ï¼Œæ›´æ–°æ­£åœ¨è¿›è¡Œçš„ä½œå“åˆ—è¡¨
            if (pageId === 'focus-page') {
                renderDoingItems();
            }
            
            // å¦‚æœæ˜¯ç»Ÿè®¡é¡µé¢ï¼Œæ›´æ–°ç»Ÿè®¡æ•°æ®
            if (pageId === 'stats-page') {
                updateStats();
            }
            
            // å¦‚æœæ˜¯æ”¶é›†å†Œé¡µé¢ï¼Œæ›´æ–°æ”¶é›†å†Œ
            if (pageId === 'collection-page') {
                renderCollection();
            }
            
            // æ›´æ–°AIæ¿€åŠ±è¯­
            updateAIMotivation();
        }
        
        // å¤„ç†è¡¨å•æäº¤
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const title = document.getElementById('item-title').value;
            const type = document.getElementById('item-type').value;
            const status = document.getElementById('item-status').value;
            const rating = document.getElementById('item-rating').value ? parseFloat(document.getElementById('item-rating').value) : null;
            const comment = document.getElementById('item-comment').value;
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ç¼–è¾‘æ¨¡å¼
            const editingItemId = elements.itemForm.getAttribute('data-editing');
            let oldStatus = null;
            
            if (editingItemId) {
                // ç¼–è¾‘ç°æœ‰ä½œå“
                const oldItem = appState.items.find(item => item.id === editingItemId);
                oldStatus = oldItem.status;
                
                // æ›´æ–°ä½œå“
                const itemIndex = appState.items.findIndex(item => item.id === editingItemId);
                appState.items[itemIndex] = {
                    ...appState.items[itemIndex],
                    title,
                    type,
                    status,
                    rating,
                    comment,
                    updatedAt: new Date().toISOString()
                };
                
                // æ£€æŸ¥çŠ¶æ€æ˜¯å¦ä»"åœ¨æ"å˜ä¸º"å·²å®Œæˆï¼"
                if (oldStatus === 'åœ¨æ' && status === 'å·²å®Œæˆï¼') {
                    appState.sparks += 1.0;
                    updateSparkDisplay();
                    await saveData();
                    showSparkNotification(1.0, "å®Œæˆä½œå“å¥–åŠ±");
                }
                
                // ç§»é™¤ç¼–è¾‘æ ‡è®°
                elements.itemForm.removeAttribute('data-editing');
            } else {
                // æ·»åŠ æ–°ä½œå“
                const newItem = {
                    id: Date.now().toString(),
                    title,
                    type,
                    status,
                    rating,
                    comment,
                    createdAt: new Date().toISOString()
                };
                
                appState.items.push(newItem);
            }
            
            await saveData();
            renderItems();
            updateAIMotivation();
            
            // é‡ç½®è¡¨å•å¹¶å…³é—­æ¨¡æ€æ¡†
            elements.itemForm.reset();
            elements.addItemModal.style.display = 'none';
        }
        
        // æ¸²æŸ“ä½œå“åˆ—è¡¨
        function renderItems() {
            elements.itemsContainer.innerHTML = '';
            
            if (appState.items.length === 0) {
                elements.emptyLibrary.style.display = 'block';
                return;
            }
            
            elements.emptyLibrary.style.display = 'none';
            
            // æŒ‰æœ€è¿‘æ›´æ–°æ—¶é—´æ’åº
            const sortedItems = [...appState.items].sort((a, b) => {
                const dateA = a.updatedAt || a.createdAt;
                const dateB = b.updatedAt || b.createdAt;
                return new Date(dateB) - new Date(dateA);
            });
            
            sortedItems.forEach(item => {
                const itemElement = createItemElement(item);
                elements.itemsContainer.appendChild(itemElement);
            });
        }
        
        // æ¸²æŸ“æ­£åœ¨è¿›è¡Œçš„ä½œå“åˆ—è¡¨
        function renderDoingItems() {
            elements.doingItemsContainer.innerHTML = '';
            
            const doingItems = appState.items.filter(item => item.status === 'åœ¨æ');
            
            if (doingItems.length === 0) {
                elements.emptyDoing.style.display = 'block';
                return;
            }
            
            elements.emptyDoing.style.display = 'none';
            
            doingItems.forEach(item => {
                const itemElement = createItemElement(item);
                elements.doingItemsContainer.appendChild(itemElement);
            });
        }
        
        // åˆ›å»ºä½œå“å…ƒç´ 
        function createItemElement(item) {
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item-card';
            itemDiv.setAttribute('data-id', item.id);
            
            // ç¡®å®šçŠ¶æ€æ ‡ç­¾ç±»
            let statusClass = 'tag-status';
            if (item.status === 'å·²å®Œæˆï¼') statusClass = 'tag-done';
            if (item.status === 'å·²å¼ƒå‘') statusClass = 'tag-dropped';
            
            // ç”Ÿæˆæ˜Ÿçº§è¯„åˆ†
            let starsHtml = '';
            if (item.rating) {
                const fullStars = Math.floor(item.rating / 2);
                const halfStar = item.rating % 2 >= 1;
                
                for (let i = 0; i < 5; i++) {
                    if (i < fullStars) {
                        starsHtml += 'â˜…';
                    } else if (i === fullStars && halfStar) {
                        starsHtml += 'Â½';
                    } else {
                        starsHtml += 'â˜†';
                    }
                }
            }
            
            itemDiv.innerHTML = `
                <div class="item-header">
                    <div>
                        <div class="item-title">${item.title}</div>
                        <div class="item-meta">
                            <span class="item-tag ${statusClass}">${item.status}</span>
                            <span class="item-tag tag-type">${item.type}</span>
                        </div>
                    </div>
                    <div>
                        <button class="edit-btn" data-id="${item.id}" style="background: none; border: none; color: var(--primary-color); font-size: 16px;">
                            <i class="fas fa-edit"></i>
                        </button>
                    </div>
                </div>
                ${item.rating ? `<div class="item-rating">${starsHtml} ${item.rating}/10</div>` : ''}
                ${item.comment ? `<div class="item-comment">${item.comment}</div>` : ''}
            `;
            
            // æ·»åŠ ç¼–è¾‘äº‹ä»¶
            const editBtn = itemDiv.querySelector('.edit-btn');
            editBtn.addEventListener('click', () => editItem(item.id));
            
            return itemDiv;
        }
        
        // ç¼–è¾‘ä½œå“
        function editItem(id) {
            const item = appState.items.find(item => item.id === id);
            if (!item) return;
            
            // å¡«å……è¡¨å•
            document.getElementById('item-title').value = item.title;
            document.getElementById('item-type').value = item.type;
            document.getElementById('item-status').value = item.status;
            document.getElementById('item-rating').value = item.rating || '';
            document.getElementById('item-comment').value = item.comment || '';
            
            // è®¾ç½®ç¼–è¾‘æ ‡è®°
            elements.itemForm.setAttribute('data-editing', id);
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            elements.addItemModal.style.display = 'flex';
        }
        
        // æ›´æ–°ç«èŠ±æ˜¾ç¤º
        function updateSparkDisplay() {
            elements.sparkCount.textContent = appState.sparks.toFixed(1);
        }
        
        // æ˜¾ç¤ºç«èŠ±è·å¾—é€šçŸ¥
        function showSparkNotification(amount, reason) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <i class="fas fa-fire"></i>
                <div>
                    <div>+${amount.toFixed(1)} ç«èŠ±</div>
                    <div style="font-size: 12px;">${reason}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 3000);
        }
        
        // è®¡æ—¶å™¨åŠŸèƒ½
        function startTimer() {
            if (appState.timer.isRunning) return;
            
            appState.timer.isRunning = true;
            elements.startTimer.disabled = true;
            elements.pauseTimer.disabled = false;
            elements.claimSparks.disabled = true;
            
            appState.timer.interval = setInterval(() => {
                appState.timer.timeLeft--;
                updateTimerDisplay();
                
                if (appState.timer.timeLeft <= 0) {
                    clearInterval(appState.timer.interval);
                    appState.timer.isRunning = false;
                    elements.claimSparks.disabled = false;
                    elements.pauseTimer.disabled = true;
                }
            }, 1000);
        }
        
        function pauseTimer() {
            if (!appState.timer.isRunning) return;
            
            clearInterval(appState.timer.interval);
            appState.timer.isRunning = false;
            elements.startTimer.disabled = false;
            elements.pauseTimer.disabled = true;
        }
        
        function resetTimer() {
            clearInterval(appState.timer.interval);
            appState.timer.isRunning = false;
            appState.timer.timeLeft = 25 * 60;
            elements.startTimer.disabled = false;
            elements.pauseTimer.disabled = true;
            elements.claimSparks.disabled = true;
            updateTimerDisplay();
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(appState.timer.timeLeft / 60);
            const seconds = appState.timer.timeLeft % 60;
            elements.timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        async function claimSparks() {
            appState.sparks += 0.1;
            updateSparkDisplay();
            await saveData();
            showSparkNotification(0.1, "ä¸“æ³¨å¥–åŠ±");
            updateAIMotivation();
            resetTimer();
        }
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats() {
            // æ€»ä½œå“æ•°
            elements.totalItems.textContent = appState.items.length;
            
            // å·²å®Œæˆä½œå“æ•°
            const completedCount = appState.items.filter(item => item.status === 'å·²å®Œæˆï¼').length;
            elements.completedItems.textContent = completedCount;
            
            // å¹³å‡è¯„åˆ†
            const ratedItems = appState.items.filter(item => item.rating);
            const avgRating = ratedItems.length > 0 ? 
                (ratedItems.reduce((sum, item) => sum + item.rating, 0) / ratedItems.length).toFixed(1) : 
                '0.0';
            elements.avgRating.textContent = avgRating;
            
            // æ€»ç«èŠ±æ•°
            elements.totalSparks.textContent = appState.sparks.toFixed(1);
            
            // ç±»å‹åˆ†å¸ƒ
            updateTypeChart();
            
            // çŠ¶æ€åˆ†å¸ƒ
            updateStatusChart();
        }
        
        // æ›´æ–°ç±»å‹åˆ†å¸ƒå›¾è¡¨
        function updateTypeChart() {
            const typeCounts = {};
            appState.items.forEach(item => {
                typeCounts[item.type] = (typeCounts[item.type] || 0) + 1;
            });
            
            let chartHtml = '<div style="margin-top: 10px;">';
            for (const type in typeCounts) {
                const count = typeCounts[type];
                const percentage = appState.items.length > 0 ? (count / appState.items.length * 100).toFixed(1) : 0;
                
                chartHtml += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px;">
                        <span>${type}</span>
                        <span>${count} (${percentage}%)</span>
                    </div>
                    <div style="height: 10px; background: #e0e0e0; border-radius: 5px; margin-bottom: 10px;">
                        <div style="height: 100%; width: ${percentage}%; background: var(--primary-color); border-radius: 5px;"></div>
                    </div>
                `;
            }
            chartHtml += '</div>';
            
            elements.typeChart.innerHTML = chartHtml;
        }
        
        // æ›´æ–°çŠ¶æ€åˆ†å¸ƒå›¾è¡¨
        function updateStatusChart() {
            const statusCounts = {};
            appState.items.forEach(item => {
                statusCounts[item.status] = (statusCounts[item.status] || 0) + 1;
            });
            
            let chartHtml = '<div style="margin-top: 10px;">';
            for (const status in statusCounts) {
                const count = statusCounts[status];
                const percentage = appState.items.length > 0 ? (count / appState.items.length * 100).toFixed(1) : 0;
                
                // ç¡®å®šé¢œè‰²
                let color = 'var(--warning)';
                if (status === 'å·²å®Œæˆï¼') color = 'var(--success)';
                if (status === 'å·²å¼ƒå‘') color = 'var(--danger)';
                if (status === 'æƒ³è¯•') color = 'var(--primary-light)';
                
                chartHtml += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px; font-size: 14px;">
                        <span>${status}</span>
                        <span>${count} (${percentage}%)</span>
                    </div>
                    <div style="height: 10px; background: #e0e0e0; border-radius: 5px; margin-bottom: 10px;">
                        <div style="height: 100%; width: ${percentage}%; background: ${color}; border-radius: 5px;"></div>
                    </div>
                `;
            }
            chartHtml += '</div>';
            
            elements.statusChart.innerHTML = chartHtml;
        }
        
        // å…‘æ¢å¥–åŠ±
        async function redeemReward(cost, rewardName) {
            if (appState.sparks < cost) {
                alert('ç«èŠ±ä¸è¶³ï¼Œæ— æ³•å…‘æ¢æ­¤å¥–åŠ±ï¼');
                return;
            }
            
            if (confirm(`ç¡®å®šè¦èŠ±è´¹ ${cost} ç«èŠ±å…‘æ¢"${rewardName}"å—ï¼Ÿ`)) {
                appState.sparks -= cost;
                updateSparkDisplay();
                await saveData();
                updateAIMotivation();
                alert(`æˆåŠŸå…‘æ¢ ${rewardName}ï¼`);
            }
        }

        // æŠ½å¡åŠŸèƒ½
        async function drawCard() {
            if (appState.sparks < 1.0) {
                alert('ç«èŠ±ä¸è¶³ï¼Œæ— æ³•æŠ½å¡ï¼');
                return;
            }

            if (!confirm('èŠ±è´¹1ç«èŠ±æŠ½å–ä¸€å¼ éšæœºå¡ç‰Œï¼Ÿ')) {
                return;
            }

            // æ‰£é™¤ç«èŠ±
            appState.sparks -= 1.0;
            updateSparkDisplay();
            await saveData();

            // éšæœºé€‰æ‹©å¡ç‰Œï¼ˆæŒ‰ç¨€æœ‰åº¦åŠ æƒï¼‰
            const allCards = getAllCards();
            const weights = {
                "æ™®é€š": 50,
                "ç¨€æœ‰": 30, 
                "å²è¯—": 15,
                "ä¼ è¯´": 5
            };

            let randomPool = [];
            allCards.forEach(card => {
                const weight = weights[card.rarity] || 10;
                for (let i = 0; i < weight; i++) {
                    randomPool.push(card);
                }
            });

            const drawnCard = randomPool[Math.floor(Math.random() * randomPool.length)];
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯æ–°å¡
            const isNewCard = !appState.collectedCards.includes(drawnCard.id);
            
            if (isNewCard) {
                appState.collectedCards.push(drawnCard.id);
                await saveData();
            }

            // æ˜¾ç¤ºæŠ½åˆ°çš„å¡ç‰Œ
            showDrawnCard(drawnCard, isNewCard);
            
            // æ›´æ–°ç»Ÿè®¡
            updateCollectionStats();
            updateAIMotivation();
            
            // é‡æ–°æ¸²æŸ“æ”¶é›†å†Œä»¥æ˜¾ç¤ºæ–°è·å¾—çš„å¡ç‰Œ
            renderCollection();
        }

        // æ˜¾ç¤ºæŠ½åˆ°çš„å¡ç‰Œ
        function showDrawnCard(card, isNew) {
            elements.cardDisplay.innerHTML = '';
            elements.cardDisplay.classList.add('card-animation');
            
            // æ ¹æ®ç¨€æœ‰åº¦æ·»åŠ è¾¹æ¡†ç±»
            const rarityClass = getRarityClass(card.rarity);
            elements.cardDisplay.className = `card-display ${rarityClass}`;
            
            // å°è¯•åŠ è½½å›¾ç‰‡
            const cardImg = document.createElement('img');
            cardImg.src = card.image;
            cardImg.alt = card.name;
            cardImg.className = 'card-image';
            cardImg.onerror = function() {
                // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºæ–‡æœ¬å†…å®¹
                this.style.display = 'none';
                const cardContent = document.createElement('div');
                cardContent.className = 'card-text-content';
                
                cardContent.innerHTML = `
                    <div style="font-size: 14px; font-weight: bold; margin-bottom: 5px;">${card.name}</div>
                    <div style="font-size: 12px; color: ${getRarityColor(card.rarity)}; margin-bottom: 10px;">${card.rarity}</div>
                    <div style="font-size: 24px; margin-bottom: 10px;">ğŸ¹</div>
                    <div style="font-size: 10px; color: #666;">å¥¶èŒ¶é¼ ç³»åˆ—</div>
                `;
                
                elements.cardDisplay.appendChild(cardContent);
            };
            
            cardImg.onload = function() {
                // å›¾ç‰‡åŠ è½½æˆåŠŸï¼Œç§»é™¤ä»»ä½•å¯èƒ½å­˜åœ¨çš„æ–‡æœ¬å†…å®¹
                const existingContent = elements.cardDisplay.querySelector('.card-text-content');
                if (existingContent) {
                    existingContent.remove();
                }
            };
            
            elements.cardDisplay.appendChild(cardImg);
            
            if (isNew) {
                const newBadge = document.createElement('div');
                newBadge.className = 'new-card-badge';
                newBadge.textContent = 'æ–°!';
                elements.cardDisplay.appendChild(newBadge);
                
                // æ˜¾ç¤ºè·å¾—æ–°å¡çš„é€šçŸ¥
                showSparkNotification(0, `è·å¾—æ–°å¡ç‰Œ: ${card.name} (${card.rarity})`);
            }

            // ç§»é™¤åŠ¨ç”»ç±»ï¼Œä»¥ä¾¿ä¸‹æ¬¡å¯ä»¥é‡æ–°æ·»åŠ 
            setTimeout(() => {
                elements.cardDisplay.classList.remove('card-animation');
            }, 800);
        }

        // æ›´æ–°å¡ç‰Œå±•ç¤º
        function updateCardDisplay() {
            if (appState.collectedCards.length > 0) {
                // æ˜¾ç¤ºæœ€åè·å¾—çš„å¡ç‰Œ
                const lastCardId = appState.collectedCards[appState.collectedCards.length - 1];
                const lastCard = findCardById(lastCardId);
                if (lastCard) {
                    elements.cardDisplay.innerHTML = '';
                    
                    // æ ¹æ®ç¨€æœ‰åº¦æ·»åŠ è¾¹æ¡†ç±»
                    const rarityClass = getRarityClass(lastCard.rarity);
                    elements.cardDisplay.className = `card-display ${rarityClass}`;
                    
                    // å°è¯•åŠ è½½å›¾ç‰‡
                    const cardImg = document.createElement('img');
                    cardImg.src = lastCard.image;
                    cardImg.alt = lastCard.name;
                    cardImg.className = 'card-image';
                    cardImg.onerror = function() {
                        // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºæ–‡æœ¬å†…å®¹
                        this.style.display = 'none';
                        const cardContent = document.createElement('div');
                        cardContent.className = 'card-text-content';
                        
                        cardContent.innerHTML = `
                            <div style="font-size: 14px; font-weight: bold; margin-bottom: 5px;">${lastCard.name}</div>
                            <div style="font-size: 12px; color: ${getRarityColor(lastCard.rarity)}; margin-bottom: 10px;">${lastCard.rarity}</div>
                            <div style="font-size: 24px; margin-bottom: 10px;">ğŸ¹</div>
                            <div style="font-size: 10px; color: #666;">å¥¶èŒ¶é¼ ç³»åˆ—</div>
                        `;
                        
                        elements.cardDisplay.appendChild(cardContent);
                    };
                    
                    elements.cardDisplay.appendChild(cardImg);
                }
            } else {
                elements.cardDisplay.innerHTML = '<div class="card-placeholder">ç‚¹å‡»æŠ½å¡è·å¾—ç¬¬ä¸€å¼ å¡ç‰Œï¼</div>';
                elements.cardDisplay.className = 'card-display';
            }
        }

        // æ›´æ–°æ”¶é›†ç»Ÿè®¡
        function updateCollectionStats() {
            const total = getAllCards().length;
            const collected = appState.collectedCards.length;
            
            elements.collectedCount.textContent = collected;
            elements.totalCards.textContent = total;
            
            // æ›´æ–°æ€»è¿›åº¦
            const progress = total > 0 ? Math.round((collected / total) * 100) : 0;
            elements.totalProgress.textContent = `${progress}%`;
            
            // æ›´æ–°æŠ½å¡æŒ‰é’®çŠ¶æ€
            elements.gachaBtn.disabled = appState.sparks < 1.0;
        }

        // æ¸²æŸ“æ”¶é›†å†Œ
        function renderCollection() {
            elements.collectionContainer.innerHTML = '';
            
            for (const seriesId in cardData) {
                const series = cardData[seriesId];
                const seriesDiv = document.createElement('div');
                seriesDiv.className = 'collection-series';
                
                // è®¡ç®—ç³»åˆ—è¿›åº¦
                const seriesCards = series.cards;
                const collectedInSeries = seriesCards.filter(card => 
                    appState.collectedCards.includes(card.id)
                ).length;
                const seriesProgress = Math.round((collectedInSeries / seriesCards.length) * 100);
                
                seriesDiv.innerHTML = `
                    <div class="series-header">
                        <div class="series-title">${series.name}</div>
                        <div class="series-progress">${collectedInSeries}/${seriesCards.length} (${seriesProgress}%)</div>
                    </div>
                    <div class="cards-grid" id="grid-${seriesId}">
                        <!-- å¡ç‰Œå°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                `;
                
                elements.collectionContainer.appendChild(seriesDiv);
                
                // æ·»åŠ å¡ç‰Œåˆ°ç½‘æ ¼
                const grid = document.getElementById(`grid-${seriesId}`);
                seriesCards.forEach(card => {
                    const cardDiv = document.createElement('div');
                    const isObtained = appState.collectedCards.includes(card.id);
                    
                    // åªåœ¨è·å¾—å¡ç‰Œåæ·»åŠ ç¨€æœ‰åº¦è¾¹æ¡†ç±»
                    const rarityClass = isObtained ? getRarityClass(card.rarity) : '';
                    
                    cardDiv.className = `collection-card ${rarityClass} ${isObtained ? 'obtained' : ''}`;
                    
                    if (isObtained) {
                        // å°è¯•åŠ è½½å›¾ç‰‡
                        const cardImg = document.createElement('img');
                        cardImg.src = card.image;
                        cardImg.alt = card.name;
                        cardImg.className = 'card-image';
                        cardImg.onerror = function() {
                            // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œæ˜¾ç¤ºæ–‡æœ¬å†…å®¹
                            this.style.display = 'none';
                            const textContent = document.createElement('div');
                            textContent.style.width = '100%';
                            textContent.style.height = '100%';
                            textContent.style.display = 'flex';
                            textContent.style.flexDirection = 'column';
                            textContent.style.alignItems = 'center';
                            textContent.style.justifyContent = 'center';
                            textContent.style.padding = '10px';
                            textContent.style.textAlign = 'center';
                            
                            textContent.innerHTML = `
                                <div style="font-size: 12px; font-weight: bold; margin-bottom: 5px;">${card.name}</div>
                                <div style="font-size: 24px; margin-bottom: 5px;">ğŸ¹</div>
                                <div style="font-size: 10px; color: #666;">å¥¶èŒ¶é¼ ç³»åˆ—</div>
                            `;
                            
                            cardDiv.appendChild(textContent);
                        };
                        
                        cardDiv.appendChild(cardImg);
                        
                        // æ·»åŠ ç¨€æœ‰åº¦å¾½ç« 
                        const rarityBadge = document.createElement('div');
                        rarityBadge.className = 'rarity-badge';
                        rarityBadge.textContent = card.rarity;
                        cardDiv.appendChild(rarityBadge);
                        
                        // æ·»åŠ å¡ç‰Œåç§°æ ‡ç­¾
                        const nameLabel = document.createElement('div');
                        nameLabel.style.position = 'absolute';
                        nameLabel.style.bottom = '5px';
                        nameLabel.style.left = '5px';
                        nameLabel.style.right = '5px';
                        nameLabel.style.background = 'rgba(0,0,0,0.7)';
                        nameLabel.style.color = 'white';
                        nameLabel.style.padding = '2px 5px';
                        nameLabel.style.borderRadius = '4px';
                        nameLabel.style.fontSize = '10px';
                        nameLabel.style.textAlign = 'center';
                        nameLabel.textContent = card.name;
                        cardDiv.appendChild(nameLabel);
                    } else {
                        cardDiv.innerHTML = `
                            <div class="card-locked">
                                <i class="fas fa-lock"></i>
                            </div>
                            <div style="position: absolute; bottom: 5px; left: 5px; right: 5px; background: rgba(0,0,0,0.7); color: white; padding: 2px 5px; border-radius: 4px; font-size: 10px; text-align: center;">
                                ???
                            </div>
                        `;
                    }
                    
                    grid.appendChild(cardDiv);
                });
            }
        }

        // è¾…åŠ©å‡½æ•°
        function getAllCards() {
            let allCards = [];
            for (const seriesId in cardData) {
                allCards = allCards.concat(cardData[seriesId].cards);
            }
            return allCards;
        }

        function findCardById(cardId) {
            for (const seriesId in cardData) {
                const card = cardData[seriesId].cards.find(c => c.id === cardId);
                if (card) return card;
            }
            return null;
        }
        
        // è·å–ç¨€æœ‰åº¦å¯¹åº”çš„CSSç±»
        function getRarityClass(rarity) {
            switch(rarity) {
                case 'æ™®é€š': return 'rarity-common';
                case 'ç¨€æœ‰': return 'rarity-rare';
                case 'å²è¯—': return 'rarity-epic';
                case 'ä¼ è¯´': return 'rarity-legendary';
                default: return 'rarity-common';
            }
        }
        
        // è·å–ç¨€æœ‰åº¦å¯¹åº”çš„é¢œè‰²
        function getRarityColor(rarity) {
            switch(rarity) {
                case 'æ™®é€š': return 'var(--common-color)';
                case 'ç¨€æœ‰': return 'var(--rare-color)';
                case 'å²è¯—': return 'var(--epic-color)';
                case 'ä¼ è¯´': return 'var(--legendary-color)';
                default: return 'var(--common-color)';
            }
        }
        
        // åˆå§‹åŒ–åº”ç”¨
        initApp();
    </script>
</body>
</html>
